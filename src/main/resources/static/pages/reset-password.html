<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - PayFlow Wallet</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="logo">
                <span class="logo-icon">üí≥</span>
                <span class="logo-text">PayFlow</span>
            </div>

            <h1 class="auth-title">Reset Password</h1>
            <p class="auth-subtitle">Enter the reset token and your new password</p>

            <form onsubmit="handleResetPassword(event)">
                <div class="form-group">
                    <label class="form-label" for="token">Reset Token</label>
                    <input 
                        type="text" 
                        id="token" 
                        class="form-input" 
                        placeholder="Paste your reset token here"
                        required
                    >
                    <small style="color: var(--text-secondary); font-size: 13px; margin-top: 5px; display: block;">
                        Check console for the token (testing only)
                    </small>
                </div>

                <div class="form-group">
                    <label class="form-label" for="newPassword">New Password</label>
                    <div class="password-wrapper">
                        <input 
                            type="password" 
                            id="newPassword" 
                            class="form-input" 
                            placeholder="Enter new password"
                            minlength="8"
                            required
                        >
                        <button 
                            type="button" 
                            class="toggle-password" 
                            onclick="togglePassword('newPassword')"
                        >
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirmPassword">Confirm New Password</label>
                    <div class="password-wrapper">
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            class="form-input" 
                            placeholder="Confirm new password"
                            minlength="8"
                            required
                        >
                        <button 
                            type="button" 
                            class="toggle-password" 
                            onclick="togglePassword('confirmPassword')"
                        >
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn-primary">Reset Password</button>
            </form>

            <div class="auth-switch">
                <a href="../index.html">Back to Login</a>
            </div>
        </div>
    </div>

    <script src="../js/app.js"></script>
    <script>
        async function handleResetPassword(event) {
            event.preventDefault();
            
            const token = document.getElementById('token').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const submitBtn = event.target.querySelector('button[type="submit"]');

            if (newPassword !== confirmPassword) {
                showAlert('Passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 8) {
                showAlert('Password must be at least 8 characters', 'error');
                return;
            }

            setLoading(submitBtn, true);

            try {
                await apiCall('/auth/reset-password', {
                    method: 'POST',
                    body: JSON.stringify({ token, newPassword })
                });

                showAlert('Password reset successful! Redirecting to login...', 'success');

                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 2000);
            } catch (error) {
                showAlert(error.message || 'Password reset failed. Token may be invalid or expired.', 'error');
                setLoading(submitBtn, false);
            }
        }
    </script>
</body>
</html>
